# SmartCutElf 新功能说明

本文档介绍 v1.0 版本新增的优化功能。

## 🎯 功能概览

### 1. 友好的错误处理 ⭐⭐⭐⭐⭐

**特性：**
- 详细的错误说明和解决方案
- 错误代码分类管理
- 中文友好提示
- 相关文档链接

**使用示例：**
```python
from utils.error_handler import UserFriendlyError, ErrorCode

# 抛出友好错误
raise UserFriendlyError(
    ErrorCode.FFMPEG_NOT_FOUND,
    "未在系统PATH中找到 FFmpeg"
)
```

**错误类型：**
- `E001-E004`: 文件相关错误
- `E101-E103`: FFmpeg 相关错误
- `E201-E203`: 处理相关错误
- `E301-E302`: AI 功能错误
- `E401-E402`: 配置相关错误

### 2. 性能监控和优化 ⭐⭐⭐⭐⭐

**内存监控：**
- 实时显示系统内存使用
- 内存警告（80%）和危险（90%）提示
- 进程内存占用监控

**进度管理：**
- 断点续传支持
- 进度缓存和恢复
- 处理状态持久化

**性能预估：**
- 基于历史数据预估处理时间
- 显示剩余时间
- 智能调整并行数量

**使用示例：**
```python
from utils.performance import MemoryMonitor, PerformanceEstimator

# 内存监控
monitor = MemoryMonitor()
status, message = monitor.check_memory_status()
print(f"内存状态: {status} - {message}")

# 时间预估
estimator = PerformanceEstimator()
estimated_time = estimator.estimate_time(file_size_mb=100, duration_sec=600)
print(f"预估时间: {estimator.format_time(estimated_time)}")
```

### 3. 用户体验增强 ⭐⭐⭐⭐

**系统通知：**
- 处理完成桌面通知
- Windows/Linux/Mac 跨平台支持
- 自动提醒功能

**快捷操作：**
- 一键打开输出目录
- 复制日志到剪贴板
- 导出日志文件
- 在文件管理器中显示文件

**使用示例：**
```python
from utils.notifications import SystemNotifier, FileOperations

# 发送通知
SystemNotifier.notify(
    "处理完成",
    "已成功处理 5 个视频文件",
    icon="info"
)

# 打开输出目录
FileOperations.open_folder("output/")

# 在文件管理器中显示文件
FileOperations.reveal_in_folder("output/video_edited.mp4")
```

### 4. 配置预设模式 ⭐⭐⭐⭐⭐

**6 种预设模式：**

| 模式 | 图标 | 说明 | 适用场景 |
|------|------|------|----------|
| 快速模式 | ⚡ | 快速处理，适合预览 | 测试、预览 |
| 平衡模式 | ⚖️ | 平衡速度和质量 | 日常使用（推荐） |
| 高质量模式 | 💎 | 最佳质量输出 | 正式发布 |
| 仅字幕模式 | 📝 | 只生成字幕 | 字幕制作 |
| 短视频模式 | 📱 | 竖屏短视频 | 抖音、快手 |
| 长视频模式 | 🎬 | 横屏长视频 | B站、YouTube |

**使用方法：**
```python
from utils.config_presets import PresetManager

# 应用预设
PresetManager.apply_preset("balanced", config)

# 获取所有预设
presets = PresetManager.get_all_presets()
for preset in presets:
    print(f"{preset.icon} {preset.name}: {preset.description}")
```

**预设对比：**

| 特性 | 快速 | 平衡 | 高质量 |
|------|------|------|--------|
| 处理速度 | ⚡⚡⚡ | ⚡⚡ | ⚡ |
| 输出质量 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 字幕生成 | ❌ | ✅ | ✅ |
| 转场效果 | ❌ | ✅ | ✅ |
| 并行数量 | 8 | 4 | 2 |
| Whisper模型 | tiny | base | small |

### 5. 增强的日志系统 ⭐⭐⭐⭐

**两种日志模式：**

**用户模式：**
- 简洁友好的提示
- 图标化显示
- 隐藏技术细节

**调试模式：**
- 详细技术信息
- 完整堆栈跟踪
- 性能数据

**使用示例：**
```python
from utils.debug_logger import get_enhanced_logger, LogMode

# 获取日志器
logger = get_enhanced_logger("SmartCutElf", LogMode.USER)

# 记录日志
logger.info("开始处理视频", user_message="正在处理，请稍候...")
logger.warning("内存使用较高", user_message="建议关闭其他程序")
logger.error("处理失败", user_message="视频文件可能已损坏")

# 进度日志
logger.progress(5, 10, "处理中...")

# 导出日志
log_file = logger.export_log()
print(f"日志已导出到: {log_file}")
```

## 📖 使用指南

### 选择处理模式

1. 打开应用程序
2. 在"处理模式"下拉框中选择合适的预设
3. 查看预设说明了解详情
4. 点击"查看对比"查看所有模式的详细对比

### 监控处理进度

处理过程中会显示：
- 当前进度百分比
- 预估剩余时间
- 内存使用情况
- 详细处理日志

### 处理完成后

自动功能：
- 桌面通知提醒
- 显示处理结果统计
- 提供输出目录链接

快捷操作：
- 点击"打开输出目录"查看结果
- 点击"复制日志"复制处理日志
- 点击"导出日志"保存日志文件

### 错误处理

遇到错误时：
1. 查看错误对话框的详细说明
2. 按照解决方案步骤操作
3. 点击文档链接查看详细帮助
4. 导出日志用于问题反馈

## 🔧 高级功能

### 自定义预设

```python
from utils.config_presets import CustomPreset

# 保存当前配置为自定义预设
CustomPreset.save_custom_preset(
    name="我的预设",
    description="自定义的处理设置",
    config=config
)

# 加载自定义预设
custom_presets = CustomPreset.load_custom_presets()
```

### 性能优化建议

**内存优化：**
- 减少并行处理数量
- 使用更小的 Whisper 模型
- 关闭不需要的功能

**速度优化：**
- 使用快速模式预设
- 增加并行数量
- 关闭转场效果

**质量优化：**
- 使用高质量模式
- 选择更大的 Whisper 模型
- 启用转场效果

### 断点续传

如果处理中断：
1. 重新启动应用
2. 选择相同的文件
3. 系统会检测到之前的进度
4. 选择"继续"从断点恢复

## 💡 最佳实践

### 首次使用

1. 使用"快速模式"测试 1-2 分钟的短视频
2. 检查输出结果是否符合预期
3. 根据需求调整到合适的模式

### 日常使用

1. 推荐使用"平衡模式"
2. 定期清理输出目录
3. 关注内存使用提示
4. 保存常用的自定义预设

### 批量处理

1. 选择"快速模式"先预览效果
2. 确认无误后使用"平衡模式"或"高质量模式"
3. 监控内存使用，避免系统卡顿
4. 处理大量文件时分批进行

### 问题排查

1. 开启"调试模式"查看详细日志
2. 导出日志文件保存
3. 查看错误代码和解决方案
4. 参考相关文档

## 🆘 常见问题

### Q: 如何选择合适的处理模式？

**A:** 
- 测试/预览 → 快速模式
- 日常使用 → 平衡模式（推荐）
- 正式发布 → 高质量模式
- 短视频平台 → 短视频模式
- 长视频平台 → 长视频模式

### Q: 内存使用过高怎么办？

**A:**
1. 关闭其他占用内存的程序
2. 减少并行处理数量
3. 使用更小的 Whisper 模型（tiny）
4. 处理较小的视频文件

### Q: 如何提高处理速度？

**A:**
1. 使用快速模式
2. 增加并行数量（不超过 CPU 核心数）
3. 关闭字幕和配音功能
4. 使用 SSD 硬盘

### Q: 处理失败如何查看详细错误？

**A:**
1. 查看错误对话框的详细说明
2. 点击"导出日志"保存日志文件
3. 开启调试模式重新处理
4. 查看 logs 目录的日志文件

### Q: 如何保存我的常用设置？

**A:**
使用自定义预设功能：
1. 调整好所有设置
2. 在设置对话框点击"保存为预设"
3. 输入预设名称和描述
4. 下次使用时直接选择该预设

## 📚 相关文档

- [使用说明](使用说明.md) - 基础使用指南
- [启动指南](启动指南.md) - 安装和配置
- [技术设计](Technical_Design.md) - 技术架构
- [部署指南](部署指南.md) - 打包和分发

## 🔄 更新历史

### v1.0.0 (2024-11-20)

**新增功能：**
- ✨ 友好的错误处理系统
- ✨ 性能监控和内存管理
- ✨ 处理时间预估
- ✨ 桌面通知支持
- ✨ 6种配置预设模式
- ✨ 增强的日志系统
- ✨ 快捷操作工具

**优化改进：**
- 🔧 更好的用户体验
- 🔧 详细的错误说明
- 🔧 智能资源管理
- 🔧 断点续传支持

---

返回 [项目主页](../README.md)
